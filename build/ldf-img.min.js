/* 
 * ldf-img 
 * version: 1.0.6 
 * author: ldf 
 * 2017-07-31 
 */
!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define([],b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=0)}([function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),function(a,b){var c=function(){var a=this;a.removeDom(),a.createDom()};c.prototype={options:{maxWH:1024,quality:600,FDkey:"picture"},backData:{dataURL:"",Blob:"",fileFormData:"",W:0,H:0,size:0},init:function(a,b){var c=this;if(a.maxWH&&(c.options.maxWH=a.maxWH),a.quality&&(c.options.quality=a.quality),a.FDkey){if("string"!=typeof a.FDkey)return void alert("FDkey应为字符!");c.options.FDkey=a.FDkey}var d=document.getElementById("inputfile");d.click(),d.addEventListener("change",function(a){var d=a.target.files,e=d[0],f=e.type,g=Math.round(e.size/1024),h=e.name;c.backData.size=g;var i=new FileReader;i.readAsDataURL(e),i.onload=function(){var a=i.result;c.WHcompress(f,h,a,c.options.quality,function(a){a.compressSizeRate<1?c.sizeCompress(f,h,a.newImgData,a.compressSizeRate,function(){"function"==typeof b&&b(c.backData)}):"function"==typeof b&&b(c.backData)})},i.onloadend=function(){c.removeDom(),c.createDom()}})},createDom:function(){(document.body||document.documentElement).insertAdjacentHTML("beforeEnd",'<div class="dom-container" style="display: none">\n                            <canvas id="canvas"></canvas>\n                            <input id="inputfile" type="file" accept="image/*">\n                         </div>')},removeDom:function(){for(var a=document.getElementsByClassName("dom-container"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},WHcompress:function(a,b,c,d,e){var f=this,g=new Image;g.src=c,g.onload=function(){var c=g.width,d=g.height,h=f.dWH(c,d,f.options.maxWH),i=document.getElementById("canvas"),j=i.getContext("2d");i.width=h.width,i.height=h.height,j.clearRect(0,0,i.width,i.height),j.drawImage(g,0,0,i.width,i.height);var k=i.toDataURL(a,1),l=f.fileSizeKB(k),m=f.qualityRate(k,f.options.quality);if(f.backData.H=h.width,f.backData.W=h.height,f.backData.size=l,m>=1){var n=f.dataURLtoBlob(k,a),o=f.toFileFormData("",n,b);f.backData.dataURL=k,f.backData.size=l,f.backData.Blob=n,f.backData.fileFormData=o}"function"==typeof e&&e({compressSizeRate:m,newImgData:k})}},sizeCompress:function(a,b,c,d,e){var f=this,g=new Image;g.src=c,g.onload=function(){var c=g.width,h=g.height,i=f.dWH(c,h,f.options.maxWH),j=document.getElementById("canvas"),k=j.getContext("2d");j.width=i.width,j.height=i.height,k.clearRect(0,0,j.width,j.height),k.drawImage(g,0,0,j.width,j.height);var l=j.toDataURL(a,d),m=f.fileSizeKB(l),n=f.dataURLtoBlob(l,b),o=f.toFileFormData("",n,b);f.backData.dataURL=l,f.backData.size=m,f.backData.Blob=n,f.backData.fileFormData=o,"function"==typeof e&&e({newImgData:l})}},dWH:function(a,b,c){var d={width:a,height:b};return Math.max(a,b)>c?a>b?(d.width=c,d.height=Math.round(b*(c/a)),d):(d.height=c,d.width=Math.round(a*(c/b)),d):d},fileSizeKB:function(a){return Math.round(3*a.split(",")[1].length/4/1024)},qualityRate:function(a,b){var c=this,d=c.fileSizeKB(a);return Math.round((b-1)/d*100)/100},dataURLtoBlob:function(a,b,c){for(var d=atob(a.split(",")[1]),e=a.split(",")[0].split(":")[1].split(";")[0],f=new ArrayBuffer(d.length),g=new Uint8Array(f),h=0;h<d.length;h++)g[h]=d.charCodeAt(h);return b&&(e=b),new Blob([f],{type:e,name:c,lastModifiedDate:new Date})},toFileFormData:function(a,b,c){var d=this,e=new FormData,f=d.options.FDkey;if(b)return e.append(f,b,c),e;var g=d.dataURLtoBlob(a,c);return e.append(f,g,c),e}},a.LDFimg=c}(window),b.LDFimg=LDFimg}])});