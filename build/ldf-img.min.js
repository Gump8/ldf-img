 /* 
 * ldf-img 
 * version: 1.1.5 
 * @author: ldf 
 * githup: https://github.com/Gump8/ldf-img.git
 * 2017-08-10 
 * */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.LDFimg=b():a.LDFimg=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=0)}([function(a,b,c){"use strict";!function(a,b){var c=function(){var a=this;a.removeDom(),a.createDom()};c.prototype={options:{maxWH:1024,quality:200,FDkey:"picture"},backData:{dataURL:"",Blob:"",fileFormData:"",W:0,H:0,name:"",size:0},init:function(a,b){var c=this;if(a.maxWH&&(c.options.maxWH=a.maxWH),a.quality&&(c.options.quality=a.quality),a.FDkey){if("string"!=typeof a.FDkey)return void alert("FDkey应为字符!");c.options.FDkey=a.FDkey}var d=document.getElementById("ldf-input-file");d.click(),d.addEventListener("change",function(a){var d=a.target.files,e=d[0],f=e.type.replace("gif","png"),g=Math.round(e.size/1024),h=e.name;c.backData.name=h,c.backData.size=g;var i=new FileReader;i.readAsDataURL(e),i.onload=function(){var a=i.result;c.WHcompress(f,h,a,c.options.quality,function(a){a.compressSizeRate<1?c.sizeCompress(f,h,a.newImgData,a.compressSizeRate,function(){"function"==typeof b&&b(c.backData)}):"function"==typeof b&&b(c.backData)})},i.onloadend=function(){c.removeDom(),c.createDom()}})},createDom:function(){var a=this,b=document.body||document.documentElement,c='<div class="ldf-dom-container" style="display: none">\n                            <canvas id="ldf-canvas"></canvas>\n                            <input id="ldf-input-file" type="file" accept="image/*">\n                         </div>';a.isChromePC()&&(c='<div class="ldf-dom-container" style="display: none">\n                            <canvas id="ldf-canvas"></canvas>\n                            <input id="ldf-input-file" type="file" accept="image/gif,image/png,image/jpeg,image/jpg,image/bmp">\n                         </div>'),b.insertAdjacentHTML("beforeEnd",c)},removeDom:function(){for(var a=document.getElementsByClassName("ldf-dom-container"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},isChromePC:function(){var b=a.navigator.userAgent;return!(!/Windows NT/.test(b)&&!/Macintosh/.test(b)||!/Chrome/.test(b))},WHcompress:function(a,b,c,d,e){var f=this,g=new Image;g.src=c,g.onload=function(){var c=g.width,d=g.height,h=f.dWH(c,d,f.options.maxWH),i=document.getElementById("ldf-canvas"),j=i.getContext("2d");i.width=h.width,i.height=h.height,j.clearRect(0,0,i.width,i.height),j.drawImage(g,0,0,i.width,i.height);var k=i.toDataURL(a,1),l=f.fileSizeKB(k),m=f.qualityRate(k,f.options.quality);if(f.backData.H=h.width,f.backData.W=h.height,f.backData.size=l,m>=1){var n=f.dataURLtoBlob(k,a),o=f.toFileFormData("",n,b);f.backData.dataURL=k,f.backData.size=l,f.backData.Blob=n,f.backData.fileFormData=o}"function"==typeof e&&e({compressSizeRate:m,newImgData:k})}},sizeCompress:function(a,b,c,d,e){var f=this,g=new Image;g.src=c,g.onload=function(){var c=g.width,h=g.height,i=f.dWH(c,h,f.options.maxWH),j=document.getElementById("ldf-canvas"),k=j.getContext("2d");j.width=i.width,j.height=i.height,k.clearRect(0,0,j.width,j.height),k.drawImage(g,0,0,j.width,j.height);var l=j.toDataURL(a,d),m=f.fileSizeKB(l),n=f.dataURLtoBlob(l,a),o=f.toFileFormData("",n,b);f.backData.dataURL=l,f.backData.size=m,f.backData.Blob=n,f.backData.fileFormData=o,"function"==typeof e&&e({newImgData:l})}},dWH:function(a,b,c){var d={width:a,height:b};return Math.max(a,b)>c?a>b?(d.width=c,d.height=Math.round(b*(c/a)),d):(d.height=c,d.width=Math.round(a*(c/b)),d):d},fileSizeKB:function(a){return Math.round(3*a.split(",")[1].length/4/1024)},qualityRate:function(a,b){var c=this,d=c.fileSizeKB(a);return Math.round((b-1)/d*100)/100},dataURLtoBlob:function(a,b){for(var c=atob(a.split(",")[1]),d=a.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(c.length),f=new Uint8Array(e),g=0;g<c.length;g++)f[g]=c.charCodeAt(g);return b&&(d=b),new Blob([e],{type:d,lastModifiedDate:new Date})},toFileFormData:function(a,b,c){var d=this,e=new FormData,f=d.options.FDkey;if(b)return e.append(f,b,c),e;var g=d.dataURLtoBlob(a,fileType);return e.append(f,g,c),e}},a.LDFimg=c}(window),a.exports=LDFimg}])});